<?php namespace heide\Http\Controllers;use Illuminate\Http\Request;use heide\Model\Executive;use Image; class ExecutiveController extends Controller {	/*	|--------------------------------------------------------------------------	| Welcome Controller	|--------------------------------------------------------------------------	|	| This controller renders the "marketing page" for the application and	| is configured to only allow guests. Like most of the other sample	| controllers, you are free to modify or remove it as you desire.	|	*/	/**	 * Create a new controller instance.	 *	 * @return void	 */	public function __construct()	{		$this->middleware('auth');	}	/**	 * Show the application welcome screen to the user.	 *	 * @return Response	 */	public function getIndex()	{			$data = Executive::orderBy('id','desc')->paginate(15);		return view('admin.executive',['pn' => 'Executive'])->with('data',$data);	}	public function getCreate()	{		return view('admin.executive-create',['pn' => 'Executive']);	}	public function getEdit($id)	{		$data = Executive::find($id);		return view('admin.executive-create',['pn' => 'Executive'])->with('data',$data);	}	public function postCreate(Request $request)	{		$data = new Executive;		$data->name_en = $request->name_en;		$data->name_ch = $request->name_ch;		$data->position_en = $request->position_en;		$data->position_ch = $request->position_ch;		$data->position_detail_en = $request->position_detail_en;		$data->position_detail_ch = $request->position_detail_ch;		$data->topic_en = $request->topic_en;		$data->topic_ch = $request->topic_ch;		$data->introduction_en = $request->introduction_en;		$data->introduction_ch = $request->introduction_ch;		$data->detail_en = $request->detail_en;		$data->detail_ch = $request->detail_ch;		if($request->hasFile('photo')){			$file = $request->file('photo');			$filename = $file->getClientOriginalName();			$name = explode('.', $filename);			$i=2;			while (file_exists ('images/'.$filename)) {				$filename = $name[0]."_".$i.'.'.$name[1];				$i = $i+1;			}			Image::make($request->file('photo'))->resize(797,745)->save('images/'.$filename);			Image::make('images/'.$filename)->resize(797,745, function ($constraint) {				    $constraint->aspectRatio();			})->save('images/thumbs/'.$filename);			$data->photo = $filename;		}		$data->save();		return redirect('admin/Executive');	}	public function postEdit(Request $request,$id)	{		$data = Executive::find($id);		$data->name_en = $request->name_en;		$data->name_ch = $request->name_ch;		$data->position_en = $request->position_en;		$data->position_ch = $request->position_ch;		$data->position_detail_en = $request->position_detail_en;		$data->position_detail_ch = $request->position_detail_ch;		$data->topic_en = $request->topic_en;		$data->topic_ch = $request->topic_ch;		$data->introduction_en = $request->introduction_en;		$data->introduction_ch = $request->introduction_ch;		$data->detail_en = $request->detail_en;		$data->detail_ch = $request->detail_ch;		if($request->hasFile('photo')){			$file = $request->file('photo');			$filename = $file->getClientOriginalName();			$name = explode('.', $filename);			$i=2;			while (file_exists ('images/'.$filename)) {				$filename = $name[0]."_".$i.'.'.$name[1];				$i = $i+1;			}			Image::make($request->file('photo'))->resize(797,745)->save('images/'.$filename);			Image::make('images/'.$filename)->resize(797,745, function ($constraint) {				    $constraint->aspectRatio();			})->save('images/thumbs/'.$filename);			try {				unlink('images/'.$data->photo);				unlink('images/thumbs/'.$data->photo);			}catch (\Exception $e) {}			$data->photo = $filename;		}		$data->save();		return redirect('admin/Executive');	}}